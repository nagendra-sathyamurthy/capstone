{
  "info": {
    "name": "Capstone E-Commerce Workflow",
    "description": "Complete e-commerce workflow testing across all microservices",
    "version": "1.0.0",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "workflow_user_email",
      "value": "workflow@example.com",
      "type": "string"
    },
    {
      "key": "workflow_user_password",
      "value": "WorkflowTest123!",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Complete E-Commerce Workflow",
      "item": [
        {
          "name": "0. Health Check - MongoDB Connection",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Environment variables are set', function () {",
                  "    pm.expect(pm.environment.get('mongodb_username')).to.equal('Athena');",
                  "    pm.expect(pm.environment.get('mongodb_host_local')).to.equal('localhost:9000');",
                  "    pm.expect(pm.environment.get('mongodb_auth_source')).to.equal('admin');",
                  "});",
                  "",
                  "pm.test('MongoDB connection strings are configured', function () {",
                  "    const authConn = pm.environment.get('mongodb_connection_local_auth');",
                  "    pm.expect(authConn).to.include('Athena');",
                  "    pm.expect(authConn).to.include('authenticationdb');",
                  "    pm.expect(authConn).to.include('localhost:9000');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{auth_base_url}}/health",
              "host": ["{{auth_base_url}}"],
              "path": ["health"]
            },
            "description": "Health check to verify environment configuration and MongoDB credentials"
          }
        },
        {
          "name": "1. Register New User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('User registration successful', function () {",
                  "    pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{workflow_user_email}}\",\n  \"password\": \"{{workflow_user_password}}\"\n}"
            },
            "url": {
              "raw": "{{auth_base_url}}/api/auth/register",
              "host": ["{{auth_base_url}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "2. Login User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.token) {",
                  "        pm.environment.set('auth_token', response.token);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{workflow_user_email}}\",\n  \"password\": \"{{workflow_user_password}}\"\n}"
            },
            "url": {
              "raw": "{{auth_base_url}}/api/auth/login",
              "host": ["{{auth_base_url}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "3. Create Customer Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Customer created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.id) {",
                  "        pm.environment.set('customer_id', response.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Workflow\",\n  \"lastName\": \"User\",\n  \"email\": \"{{workflow_user_email}}\",\n  \"phoneNumber\": \"5551234567\",\n  \"address\": \"123 Test St, TestCity, TS 12345\"\n}"
            },
            "url": {
              "raw": "{{crm_base_url}}/api/customer",
              "host": ["{{crm_base_url}}"],
              "path": ["api", "customer"]
            }
          }
        },
        {
          "name": "4. Create Test Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Products created successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "[\n  {\n    \"name\": \"Premium Laptop\",\n    \"description\": \"High-performance laptop for professionals\",\n    \"price\": 1499.99\n  },\n  {\n    \"name\": \"Wireless Headphones\",\n    \"description\": \"Noise-cancelling wireless headphones\",\n    \"price\": 199.99\n  },\n  {\n    \"name\": \"Smartphone Case\",\n    \"description\": \"Protective case for smartphones\",\n    \"price\": 29.99\n  }\n]"
            },
            "url": {
              "raw": "{{catalog_base_url}}/api/item/bulk",
              "host": ["{{catalog_base_url}}"],
              "path": ["api", "item", "bulk"]
            }
          }
        },
        {
          "name": "5. Get Available Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Products retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const products = pm.response.json();",
                  "    if (products && products.length > 0) {",
                  "        pm.environment.set('item_id', products[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{catalog_base_url}}/api/item",
              "host": ["{{catalog_base_url}}"],
              "path": ["api", "item"]
            }
          }
        },
        {
          "name": "6. Create Shopping Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Cart created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.id) {",
                  "        pm.environment.set('cart_id', response.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{user_id}}\"\n}"
            },
            "url": {
              "raw": "{{cart_base_url}}/api/cart",
              "host": ["{{cart_base_url}}"],
              "path": ["api", "cart"]
            }
          }
        },
        {
          "name": "7. Add Items to Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Item added to cart successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"itemId\": \"{{item_id}}\",\n  \"name\": \"Premium Laptop\",\n  \"quantity\": 1,\n  \"price\": 1499.99\n}"
            },
            "url": {
              "raw": "{{cart_base_url}}/api/cart/{{cart_id}}/items",
              "host": ["{{cart_base_url}}"],
              "path": ["api", "cart", "{{cart_id}}", "items"]
            }
          }
        },
        {
          "name": "8. Create Order from Cart",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Order created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.id || response.orderId) {",
                  "        pm.environment.set('order_id', response.id || response.orderId);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{user_id}}\",\n  \"cartId\": \"{{cart_id}}\",\n  \"shippingAddress\": {\n    \"street\": \"123 Test St\",\n    \"city\": \"TestCity\",\n    \"state\": \"TS\",\n    \"zipCode\": \"12345\",\n    \"country\": \"USA\"\n  },\n  \"billingAddress\": {\n    \"street\": \"123 Test St\",\n    \"city\": \"TestCity\",\n    \"state\": \"TS\",\n    \"zipCode\": \"12345\",\n    \"country\": \"USA\"\n  }\n}"
            },
            "url": {
              "raw": "{{order_base_url}}/api/order",
              "host": ["{{order_base_url}}"],
              "path": ["api", "order"]
            }
          }
        },
        {
          "name": "9. Process Payment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Payment processed successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.id || response.paymentId) {",
                  "        pm.environment.set('payment_id', response.id || response.paymentId);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"orderId\": \"{{order_id}}\",\n  \"amount\": 1499.99,\n  \"currency\": \"USD\",\n  \"paymentMethod\": {\n    \"type\": \"CreditCard\",\n    \"cardNumber\": \"4111111111111111\",\n    \"expiryMonth\": \"12\",\n    \"expiryYear\": \"2025\",\n    \"cvv\": \"123\",\n    \"cardHolderName\": \"Workflow User\"\n  }\n}"
            },
            "url": {
              "raw": "{{payment_base_url}}/api/payment/process",
              "host": ["{{payment_base_url}}"],
              "path": ["api", "payment", "process"]
            }
          }
        },
        {
          "name": "10. Verify Order Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Order status retrieved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{auth_token}}"
              }
            ],
            "url": {
              "raw": "{{order_base_url}}/api/order/{{order_id}}",
              "host": ["{{order_base_url}}"],
              "path": ["api", "order", "{{order_id}}"]
            }
          }
        }
      ]
    }
  ]
}